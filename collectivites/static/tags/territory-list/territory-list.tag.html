<territory-list>

<header>
  <h1>{ territory.geojson.properties.name } <span if="{ territory.parent !== territory }">(<a onclick="{ goToParent }" href="">{ territory.parent.geojson.properties.name }</a>)</span></h1>
  <img if="{ territory.geojson.properties.logo }" src="{ territory.geojson.properties.logo }" width="150px" height="150px" />
</header>
<div id="territory"></div>
<div id="script"></div>

<script>
  const tag = this

  tag.on('mount', () => {
    RiotControl.trigger('territory.init', opts.udataBaseUrl)
    Territory.getOrCreate(opts.id)
      .then((territory) => {
        territory.display()
        tag.territory = territory
        tag.update()
        RiotControl.on('territory.updated', () => tag.update())
      })
      .catch((error) => {
        console.error(`${opts.udataBaseUrl} is not available at the moment.`)
        console.error(error)
        // TODO: find a more generic way to do that.
        // Fake territory to display an error.
        tag.territory = {
          geojson: {
            properties: {
              name: `Erreur de chargement depuis ${opts.udataBaseUrl} pour ${opts.id}`
            }
          }
        }
        tag.update()
      })
    let container = Z.qs('#territory')
    if (!container) return
    container.innerHTML = ''
    container.dataset.udataTerritory = opts.id.replace(/\//g, '-')
    udataScript.loadTerritory(100, true)
  })

  tag.goToParent = goToParent

  function goToParent (event) {
    if (this.territory.parent._id === 'country/fr') {
      riot.route('/')
    } else {
      riot.route(`/territory/${tag.territory.parent._id}`)
    }
  }
</script>

</territory-list>
